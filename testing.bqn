# This is a full monkey lang tokenizer (minus extensions; so no string or comments).
# No perf tests have been done on it.

srcâ†"let five = 5;
let ten = 10;

let add = fn(x, y) {
  x + y;
};

let result = add(five, ten);
!-/*5;
5 < 10 > 5;

if (5 < 10) {
    return true;
} else {
    return false;
}

10 == 10;
10 != 9;
let nottrue = false;
"

# Get all the letters, their first index, and the length of chains
azâ†('_'âŠ¸=âˆ¨('a'âŠ¸â‰¤âˆ§â‰¤âŸœ'z')âˆ¨('A'âŠ¸â‰¤âˆ§â‰¤âŸœ'Z')) src
fazâ†(Â»<âŠ¢)az
lazâ†fazÃ—(+Ã—0âŠ¸â‰ )`âŒ¾âŒ½ az

# Do the same thing to get all of the numbers
numâ†('0'âŠ¸â‰¤âˆ§â‰¤âŸœ'9') src
fnumâ†(Â»<âŠ¢)num
lnumâ†fnumÃ—(+Ã—0âŠ¸â‰ )`âŒ¾âŒ½ num

# Match all of the keywords
kwsâ†"fn"â€¿"let"â€¿"true"â€¿"false"â€¿"if"â€¿"else"â€¿"return"
piâ†{/laz=â‰ ğ•©}Â¨kws
kwiâ†pi/ËœÂ¨ kws {kwâ†ğ•¨â‹„{kwâ‰¡(â‰ kw)â†‘ğ•©â†“src}Â¨ğ•©}Â¨ pi

# Extract keyword types into full array.
kwmâ†1+â†•â‰ kwi
câ†â†•â‰ src
kwtâ†+Â´kwm(âŠ£Ã—câŠ¸âˆŠ)Â¨kwi

# Merge all length data into one general data array.
# Also includes the keyword type.
dâ†kwt+lazÃ—kwt=0
d lnumâŠ¸+â†©

# Only match the first `!=` or `==` in a chain.
# Repeats will be invalid syntax anyway.
# So it is fine to parse `====` as `==` `=` `=`.
nâ€¿eâ†â‹ˆË"!="=âŒœsrc
fneâ†e(âŠ¢âˆ§Â«âˆ˜âˆ§âŸœÂ»)n
n (Â¬fne)âŠ¸âˆ§â†©
e (Â¬Â»fne)âŠ¸âˆ§â†©
feeâ†(Â«âˆ§âŠ¢>Â»)e
e ((Â¬Â»âˆ¨âŠ¢)fee)âŠ¸âˆ§â†©

# All other symbols are just single characters.
tcâ†"+-/*<>;,(){}"
fcâ†nâˆ¨eâˆ¨tcâˆŠËœsrc

# Get all illegal tokens
fiâ†Â¬azâˆ¨numâˆ¨fcâˆ¨srcâˆŠ@+9â€¿10â€¿13â€¿32

fkwâ†kwtâ‰ 0

# Final format
# First array is i: ident, k: keyword, 0: number, e: equals, n: not equals, x: illegal, other tokens: themselves
# Second array is the index in the original src (This will be used to extract identifiers later).
# It also could be used for nice error messages.
# The last array is miscellaneous data.
# For keywords, it is the keyword type: 1: fn, 2: let, 3: true, 4: false, 5: if, 6: else, 7: return
# For identifiers and numbers, it is the length of the indentifier.

fmâ†fazâˆ¨fnumâˆ¨fkwâˆ¨fneâˆ¨feeâˆ¨fcâˆ¨fi
fâ†/fm

ttâ†fm/src
tt 'i'Â¨âŒ¾((fm/faz)âŠ¸/)â†©
tt '0'Â¨âŒ¾((fm/fnum)âŠ¸/)â†©
tt 'k'Â¨âŒ¾((fm/fkw)âŠ¸/)â†© # Note Keyword types are in data array. They could be merged here.
tt 'n'Â¨âŒ¾((fm/fne)âŠ¸/)â†©
tt 'e'Â¨âŒ¾((fm/fee)âŠ¸/)â†©
tt 'x'Â¨âŒ¾((fm/fi)âŠ¸/)â†©

d fmâŠ¸/â†©

â€¢Show â‰>ttâ€¿fâ€¿d
